{
  "variables": {
    "php_version": "{{env `PHP_VERSION`}}",
    "lms_type": "{{env `LMS_TYPE`}}",
    "local_user": "{{env `LOCAL_USER`}}"
  },
  "builders": [
    {
      "type": "amazon-ebs",
      "region": "us-west-2",
      "ssh_username": "centos",
      "source_ami_filter": {
        "filters": {
          "name": "CentOS 8*",
          "architecture": "x86_64"
        },
        "owners": ["125523088429"],
        "most_recent": true
      },
      "security_group_id": "sg-e60ad99b",
      "subnet_id": "subnet-667d3603",
      "vpc_id": "vpc-f7074292",
      "ssh_pty": false,
      "instance_type": "c5a.large",
      "ami_block_device_mappings": [
        {
          "device_name": "/dev/sda1",
          "volume_type": "gp2",
          "delete_on_termination": true
        }
      ],
      "ami_regions": ["us-west-2", "ca-central-1", "us-east-1", "eu-west-1"],
      "ami_users": ["632022659470", "634112937650"],
      "ami_name": "lambda-ansible-playbook_lms-server-{{user `lms_type`}}_php-{{user `php_version`}}",
      "force_deregister": true,
      "force_delete_snapshot": true,
      "shutdown_behavior": "terminate",
      "ena_support": true
    }
  ],
  "provisioners": [
    {
      "type": "ansible",
      "user": "centos",
      "playbook_file": "./lms-server/lms-server.yml",
      "extra_arguments": [
        "--extra-vars",
        "php={{user `php_version`}} lms={{user `lms_type`}} local_user={{user `local_user`}}"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "manifest",
      "output": "manifest.json",
      "strip_path": true
    }
  ]
}
